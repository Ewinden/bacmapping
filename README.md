# bacmapping
This is a set of tools used in production and exploration of bacterial artificial chromosome restriction maps.

## Dataset location
This dataset is kept at gigaDB at , it can also be built locally using the scripts in installing

## Installation
Install from this github repository on Linux
This package requires
numpy
pandas
Biopython
matplotlib
ast

```bash
git clone https://github.com/Ewinden/bacmapping/
cd bacmapping
sudo pip install -e .
```

## Functions
### Main pipeline functions
getNewClones(download=True)
    Download files from the FTP server, download can be set to false to not download the files found
    
narrowDownLibraries()
    Generates a file with only BAC libraries
    
splitAttributesWithMids(Ser,middles)
    An internal function required to split the weird way details are given
    
getCuts(row)
    Given a row from the mapping functions, returns all the restriction maps
    
mapSequencedClones(include_libraries=True, cpustouse=1, maxcuts=50, chunk_size=500)
    Maps all the clones which are insert sequenced
        include_libraries determines whether or not to use the list generated from narrowDownLibraries
        cpustouse determines the number of cores to use when running multiprocessing
        maxcuts determines the maximum number of cuts with a specific enzyme before the map is truncated, to save space
        chunk_size determines the amount of lines to read into pandas at once, larger is faster but requires more memory

mapPlacedClones(include_libraries=True, cpustouse=1, maxcuts=50, chunk_size=500)
    Maps all the clones which are insert sequenced
        include_libraries determines whether or not to use the list generated from narrowDownLibraries
        cpustouse determines the number of cores to use when running multiprocessing
        maxcuts determines the maximum number of cuts with a specific enzyme before the map is truncated, to save space
        chunk_size determines the amount of lines to read into pandas at once, larger is faster but requires more memory
        
### Functions for statistics regarding the database
countPlacedBACs()
    returns the number of placed BACs and library identifiers
    
getCoverage(include_libraries=True)
    determines coverage of the primary assembly for the genome
    
getAverageLength(include_libraries=True)
    returns average length of mapped clones
    
getSequencedClonesStats(include_libraries=True)
    returns statistics for the sequenced clone database

### Exploring the library
onlySingleCutters(row)
    given a row of restriction maps, returns the enzymes that only cut once

findPairs(row)
    given a for for a specific BAC, finds possible BACs with acceptable overlap and restriction sites

makePairs(cpustouse=1,longestoverlap=200,shortestoverlap=20)
    generates a database of pairs of BACs which have overlaps generated by restriction enzymes that linearize the BACs

splitAttributes(ser)
    degenerated, but perhaps useful, function to split features for a BAC
    
openSeqgetCuts(row)    
    Given a row, opens the sequence and returns all the restriction maps. This has been deprecated in the primary path, but could be useful
    
getRightIsoschizomer(ezyme)
    Given an enzyme name, returns the enzyme name and Bio.restriction class which corresponds to the isoschizomer which is in the database
    
getRow(name)
    Given the name of a BAC, tries to return the set of restriction maps for that BAC
        name is a string containing the common name of a BAC, including library, such as "RP11-168H2"
    
drawMap(name, enzyme, circular=False)
    Given the name of a BAC and an enzyme, draws a map
        name is a string containing the common name of a BAC, including library, such as "RP11-168H2"
        enzyme is a string of the common name of an enzyme included in the list
        circular is whether to return a circular or linear plot

getSequenceFromName(name)
    Given the name of a BAC, tries to return the sequence of that insert

getSequenceFromLoc(chrom,start,end)
    Given a chromosome, start and end location, returns sequence of that location

getMapFromName(name)
    Given the name of a BAC, tries to return the all the restriction maps for that name

getMapsFromLoc(chrom,start,end, inclusive=True)
    Given a chromosome, start and end location, returns all the maps in that region
        inclusive determines whether BACs that overlap the start and end locations should be included
        
getRestrictionMap(name, enzyme)
    Given the name of a BAC and an enzyme, returns the cut locations for that pair

## Use
Ensure you are on a computer/ server that can handle a large throughput and can be left for some time to download/ process everything as well as some space to save the database.
In python, the main pipeline is run as

```python
import bacmapping

bacmapping.getNewClones() # this will take some time, downloading first all the clones and then their sequences
bacmapping.narrowDownLibraries()
bacmapping.mapSequencedClones() # include cpustouse=n to use more cores on a server or computer, include chunk_size=n to use more memory and go faster
bacmapping.mapPlacedClones() # include cpustouse=n to use more cores on a server or computer, include chunk_size=n to use more memory and go faster
```

These functions will download and generate the database locally in a set of folders

## Using the database
Once the database is generated, or on the gigaDB database, restriction maps are saved first by type(insert-sequenced in sequenced or end-sequenced in placed) then library, then chromosome
Each chromosome csv is a tsv where each line is an individual BAC, then there are some details, finally all of the used enzymes are listed
If an enzyme you want isn't there, check for the isoschizomers of the enzyme, the database doesn't have all the isoschizomers to save space and time
Once the database is established, running python with bacmapping installed from the parent folder of the database gives the user access to the analysis scripts detailed above

## Authors
This project was produced in the Laboratory of Molecular and Computational Genomics at University of Wisconsin- Madison
    
Eamon Winden - ewinden@wisc.edu         
Alejandro Vasquez-Acheverri provided guidance in git, multiprocessing, python, ssh...

## License
This project is licensed under the MIT License - see the LICENSE.md file for details.
